<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Договор</title>
    <link rel="stylesheet" href="style.css">
    <link
            href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap"
            rel="stylesheet"
    />
    <link
            href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body>
<div class="main-container">
    <div class="title-position">
        <h2 class="services-title">Договор</h2>
    </div>
    <div class="services-container">
        <!--Селектор договора и текст договора-->
        <div class="services-left">
            <div class="agreement-section">
                <div class="agreement-and-text">
                    <div class="dropdown-container">
                        <details class="custom-dropdown">
                            <summary class="dropdown-toggle-type">Договор
                                <span class="dropdown-arrow">
      <img src="img/dropdown-arrow.svg" alt="v">
    </span>
                            </summary>
                            <ul class="dropdown-list">
                                <!-- Опция 1 (выбранная) -->
                                <li class="dropdown-item">
                                    <div class="type-item-name">Информирование</div>

                                </li>
                                <!-- Опция 2 (невыбранная) -->
                                <li class="dropdown-item">
                                    <div class="type-item-name">Судебная работа</div>
                                </li>
                            </ul>
                        </details>
                    </div>
                </div>
                <button class="agreement-open-button">Открыть</button>
            </div>

            <!-- Область прокручиваемого договора-->
            <div class="document-container">
                <div id="pdfViewer" class="pdf-viewer"></div>
                <div id="pdfViewerInformation" class="pdf-viewer-hidden"></div>
                <div id="pdfViewerJudicial" class="pdf-viewer-hidden"></div>
                <img src="img/read-contract.png" alt="Изучите договор" class="document-img" id="readContract">
                <img src="img/not-signed-contract.png" alt="Не подписан" class="document-img-hidden" id="notSignedContract">
                <img src="img/signed-contract.png" alt="Подписан в ЛК" class="document-img-hidden" id="signedContract">
                <img src="img/signed-edo-contract.png" alt="Подписан по ЭДО" class="document-img-hidden" id="signedEdoContract">
            </div>
        </div>

        <!-- Правая колонка (интерактив) -->
        <div class="services-right">
            <div class="menu">
                <span class="info-note">Проверьте ваши данные в договоре, в случае неточности отредактируйте в “Отредактировать реквизиты договора”</span>
                <button class="profile-settings-button">Отредактировать реквизиты</button>
            </div>
            <!-- конец настроек профиля-->
            <div class="signing-area">
                <span class="signing-title" id="signing-title">
                    <span>Получить доступ к услугам?</span>
                    <span>Подпишите договор</span>
                </span>
                <!-- чекбокс с услугами-->
                <div class="services-contract">
                    <div class="check-line">
                        <img id="checkbox" src="img/unchecked.svg" alt="[]" class="img-pointer">
                        <div class="contract-name-and-data" id="contractInfo">
                            <span class="contract-name-title">Договор предоставления услуг</span>
                            <span class="contract-date-title">Дата согласия: 14.02.2025</span>
                        </div>
                    </div>
                    <div class="confirmed" id="confirmation">
                        <img src="img/item-status-approved.svg" alt="V">
                        Подписан
                    </div>
                </div>
                <!-- дополнительные соглашения "подключите все возможности системы)-->
                <div class="extra-services-container-hidden" id="extraServiceContainer">
                    <div class="extra-services-title">Подключите все возможности системы:</div>
                    <!-- уведомления-->
                    <div class="extra-services-label">Автоматизируйте важные уведомления</div>
                    <div class="extra-services">
                        <div class="check-line">
                            <img id="notificationsCheckbox" src="img/unchecked.svg" alt="[]" class="img-pointer">
                            <div class="contract-name-and-data" id="notificationsContractInfo">
                                <span class="contract-name-title" id="notificationUncheckedTitle">Подключить услугу информирования</span>
                                <span class="contract-name-title-hidden" id="notificationCheckedTitle">Услуга информирования</span>
                                <span class="contract-date-title">Дата согласия: 14.02.2025</span>
                            </div>
                        </div>
                        <div class="confirmed" id="notificationConfirmation">
                            <img src="img/item-status-approved.svg" alt="V">
                            Подключена
                        </div>
                    </div>
                    <div class="extra-services-signing-line" id="notificationSigningLine">
                        <div class="pdf-line">
                            <img src="img/pdf-file.svg" alt="file">
                            <a href="#">Скачать PDF</a>
                        </div>
                        <button id="notificationSignButton" class="sign-button"><img src="img/item-status.svg" alt="status">Подключить
                        </button>
                    </div>
                    <img src="img/separator.png" alt="_____" class="separator">
                    <!-- судебная работа экспертам label-->
                    <div class="extra-services-label">Доверьте судебную работу экспертам</div>
                    <!-- судебная работа экспертам-->
                    <div class="extra-services">
                        <div class="check-line">
                            <img id="judicialCheckbox" src="img/unchecked.svg" alt="[]" class="img-pointer">
                            <div class="contract-name-and-data" id="judicialContractInfo">
                                <span class="contract-name-title" id="judicialUncheckedTitle">Подключить эксперта для судебной работы</span>
                                <span class="contract-name-title-hidden" id="judicialCheckedTitle">Эксперт для судебной работы</span>
                                <span class="contract-date-title">Дата согласия: 14.02.2025</span>
                            </div>
                        </div>
                        <div class="confirmed" id="judicialConfirmation">
                            <img src="img/item-status-approved.svg" alt="V">
                            Подключен
                        </div>
                    </div>
                    <!-- конец для "судебная работа экспертам"-->
                    <div class="extra-services-signing-line" id="judicialSigningLine">
                        <div class="pdf-line">
                            <img src="img/pdf-file.svg" alt="file">
                            <a href="#">Скачать PDF</a>
                        </div>
                        <button id="judicialSignButton" class="sign-button"><img src="img/item-status.svg" alt="status">Подключить
                        </button>
                    </div>
                </div>
                <div class="signing-line" id="signingLine">
                    <div class="pdf-line">
                        <img src="img/pdf-file.svg" alt="file">
                        <a href="#">Скачать PDF</a>
                    </div>
                    <button id="signButton" class="sign-button"><img src="img/item-status.svg" alt="status">Подписать
                    </button>
                </div>
            </div>
            <!-- Подвал меню справа. Кнопка скачивания документов-->
            <div class="down-menu">
                <span class="download-documents-title">Скачайте пакет документов и отправьте по системе ЭДО</span>
                <button class="download-documents-button">Скачать пакет документов</button>
            </div>
        </div>
    </div>
</div>

<script>
    //Выбор договора в селекторе
    document.querySelectorAll('.custom-dropdown').forEach((dropdown) => {
        const summary = dropdown.querySelector('summary');
        const arrow = summary.querySelector('.dropdown-arrow');
        const arrowHTML = arrow ? arrow.outerHTML : '';
        const items = dropdown.querySelectorAll('.dropdown-item');
        items.forEach((item) => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                let selectedText = '';
                const approvedName = item.querySelector('.item-name-approved');
                const normalName = item.querySelector('.item-name');
                const typeName = item.querySelector('.type-item-name');
                if (approvedName) {
                    selectedText = approvedName.textContent.trim();
                } else if (normalName) {
                    selectedText = normalName.textContent.trim();
                } else if (typeName) {
                    selectedText = typeName.textContent.trim();
                } else {
                    selectedText = item.textContent.trim();
                }
                summary.innerHTML = selectedText + arrowHTML;
                dropdown.removeAttribute('open');
                //проверяем заполнены ли все поля
                checkAllForms();
            });
        });
    });
    document.addEventListener('click', (e) => {
        document.querySelectorAll('.custom-dropdown').forEach((dropdown) => {
            if (!dropdown.contains(e.target)) {
                dropdown.removeAttribute('open');
            }
        });
    });

    //замена в правом меню чекбокса без галочки на чекбокс с галочкой
    //+ замена надписей "изучите договор" на "не подписан"

    document.addEventListener("DOMContentLoaded", function () {

        const extraServiceContainer = document.getElementById('extraServiceContainer')
        const checkbox = document.getElementById('checkbox')
        const signButton = document.getElementById('signButton')
        const notificationCheckbox = document.getElementById('notificationsCheckbox')
        const notificationSignButton = document.getElementById('notificationSignButton')
        const judicialCheckbox = document.getElementById('judicialCheckbox')
        const judicialSignButton = document.getElementById('judicialSignButton')
        const readContract = document.getElementById('readContract')
        const notSignedContract = document.getElementById('notSignedContract')
        const signedContract = document.getElementById('signedContract')
        const signedEdoContract = document.getElementById('signedEdoContract')
        const commonContract = document.getElementById('pdfViewer')
        const informationContract = document.getElementById('pdfViewerInformation')
        const judicialContract = document.getElementById('pdfViewerJudicial')

        // Функция для проверки состояния чекбоксов (если хотя бы один выбран, отображать "Изучите договор"
        function updateContractImage() {
            if (notificationCheckbox.src.endsWith('unchecked.svg') && judicialCheckbox.src.endsWith('unchecked.svg')) {
                // Если оба чекбокса НЕ выбраны, показываем "Подписан в ЛК"
                readContract.classList.add('document-img-hidden');
                readContract.classList.remove('document-img');
                signedContract.classList.remove('document-img-hidden');
                signedContract.classList.add('document-img');
                notSignedContract.classList.add('document-img-hidden');
                notSignedContract.classList.remove('document-img');
            } else {
                // Если хотя бы один чекбокс выбран, показываем "Изучите договор"
                readContract.classList.remove('document-img-hidden');
                readContract.classList.add('document-img');
                signedContract.classList.add('document-img-hidden');
                signedContract.classList.remove('document-img');
                notSignedContract.classList.remove('document-img');
                notSignedContract.classList.add('document-img-hidden');
            }
        }

        checkbox.addEventListener("click", function () {
            if (checkbox.src.endsWith('unchecked.svg')) {
                checkbox.src = 'img/checked.svg'
                checkbox.alt = '[v]'
                signButton.classList.remove('sign-button')
                signButton.classList.add('sign-button-active')
                readContract.classList.remove('document-img')
                readContract.classList.add('document-img-hidden')
                notSignedContract.classList.remove('document-img-hidden')
                notSignedContract.classList.add('document-img')
            } else {
                checkbox.src = 'img/unchecked.svg'
                checkbox.alt = '[]'
                signButton.classList.remove('sign-button-active')
                signButton.classList.add('sign-button')
                readContract.classList.remove('document-img-hidden')
                readContract.classList.add('document-img')
                notSignedContract.classList.remove('document-img')
                notSignedContract.classList.add('document-img-hidden')
            }
        })

        // секция уведомлений
        // смена надписи "подписан в лк" на "подписан по эдо"
        notificationCheckbox.addEventListener('click', function () {
            if (notificationCheckbox.src.endsWith('unchecked.svg')) {
                notificationCheckbox.src = 'img/checked.svg'
                notificationCheckbox.alt = '[v]'
                notificationSignButton.classList.remove('sign-button')
                notificationSignButton.classList.add('sign-button-active')
                commonContract.classList.remove('pdf-viewer')
                commonContract.classList.add('pdf-viewer-hidden')
                informationContract.classList.remove('pdf-viewer-hidden')
                informationContract.classList.add('pdf-viewer')
                judicialContract.classList.remove('pdf-viewer')
                judicialContract.classList.add('pdf-viewer-hidden')
            } else {
                notificationCheckbox.src = 'img/unchecked.svg'
                notificationCheckbox.alt = '[]'
                notificationSignButton.classList.remove('sign-button-active')
                notificationSignButton.classList.add('sign-button')
                informationContract.classList.remove('pdf-viewer')
                informationContract.classList.add('pdf-viewer-hidden')
                commonContract.classList.remove('pdf-viewer-hidden')
                commonContract.classList.add('pdf-viewer')
            }
            updateContractImage()
        })

        // секция судебных работ для экспертов
        judicialCheckbox.addEventListener('click', function () {
            if (judicialCheckbox.src.endsWith('unchecked.svg')) {
                judicialCheckbox.src = 'img/checked.svg'
                judicialCheckbox.alt = '[v]'
                judicialSignButton.classList.remove('sign-button')
                judicialSignButton.classList.add('sign-button-active')
                commonContract.classList.remove('pdf-viewer')
                commonContract.classList.add('pdf-viewer-hidden')
                informationContract.classList.remove('pdf-viewer')
                informationContract.classList.add('pdf-viewer-hidden')
                judicialContract.classList.remove('pdf-viewer-hidden')
                judicialContract.classList.add('pdf-viewer')
            } else {
                judicialCheckbox.src = 'img/unchecked.svg'
                judicialCheckbox.alt = '[]'
                judicialSignButton.classList.remove('sign-button-active')
                judicialSignButton.classList.add('sign-button')
                judicialContract.classList.remove('pdf-viewer')
                judicialContract.classList.add('pdf-viewer-hidden')
                commonContract.classList.remove('pdf-viewer-hidden')
                commonContract.classList.add('pdf-viewer')
            }
            updateContractImage()
        })
        // сокрытие элементов при клике на кнопку "подписать"
        //смена "печати" "не подписан" на "подписан в лк"

        const signingTitle = document.getElementById('signing-title')
        const signingLine = document.getElementById('signingLine')
        const notificationSigningLine = document.getElementById('notificationSigningLine')
        const judicialSigningLine = document.getElementById('judicialSigningLine')
        const confirmation = document.getElementById('confirmation')
        const notificationConfirmation = document.getElementById('notificationConfirmation')
        const judicialConfirmation = document.getElementById('judicialConfirmation')
        const contractInfo = document.getElementById('contractInfo')
        const notificationContractInfo = document.getElementById('notificationsContractInfo')
        const judicialContractInfo = document.getElementById('judicialContractInfo')
        const notificationUncheckedTitle = document.getElementById('notificationUncheckedTitle')
        const notificationCheckedTitle = document.getElementById('notificationCheckedTitle')
        const judicialUncheckedTitle = document.getElementById('judicialUncheckedTitle')
        const judicialCheckedTitle = document.getElementById('judicialCheckedTitle')

        let isContractSigned = false
        let isNotificationContractSigned = false
        let isJudicialContractSigned = false

        //общая кнопка
        signButton.addEventListener("click", function () {
            if (!isContractSigned) {
                signingTitle.classList.remove('signing-title')
                signingTitle.classList.add('signing-title-hidden')
                signingLine.classList.remove('signing-line')
                signingLine.classList.add('signing-line-hidden')
                confirmation.classList.remove('confirmed')
                confirmation.classList.add('confirmed-display')
                checkbox.classList.add('checkbox-hidden')
                contractInfo.classList.remove('contract-name-and-data')
                contractInfo.classList.add('contract-name-and-data-signed')
                extraServiceContainer.classList.remove('extra-services-container-hidden')
                extraServiceContainer.classList.add('extra-services-container')
                notSignedContract.classList.remove('document-img')
                notSignedContract.classList.add('document-img-hidden')
                signedContract.classList.remove('document-img-hidden')
                signedContract.classList.add('document-img')
                isContractSigned = true
            } else {
                signingTitle.classList.remove('signing-title-hidden')
                signingTitle.classList.add('signing-title')
                signingLine.classList.remove('signing-line-hidden')
                signingLine.classList.add('signing-line')
                confirmation.classList.remove('confirmed-display')
                confirmation.classList.add('confirmed')
                checkbox.classList.remove('checkbox-hidden')
                contractInfo.classList.remove('contract-name-and-data-signed')
                contractInfo.classList.add('contract-name-and-data')
                extraServiceContainer.classList.remove('extra-services-container')
                extraServiceContainer.classList.add('extra-services-container-hidden')
                notSignedContract.classList.remove('document-img-hidden')
                notSignedContract.classList.add('document-img')
                signedContract.classList.remove('document-img')
                signedContract.classList.add('document-img-hidden')
                isContractSigned = false
            }
        })

        //кнопка в блоке информирования
        // При появлении договора информирования, смена надписи "изучите договор" на "подписан в лк" при нажатии кнопки
        notificationSignButton.addEventListener("click", function () {
            if (!isNotificationContractSigned) {
                notificationSigningLine.classList.remove('signing-line')
                notificationSigningLine.classList.add('signing-line-hidden')
                notificationConfirmation.classList.remove('confirmed')
                notificationConfirmation.classList.add('confirmed-display')
                notificationCheckbox.classList.add('checkbox-hidden')
                notificationContractInfo.classList.remove('contract-name-and-data')
                notificationContractInfo.classList.add('contract-name-and-data-signed')
                notificationUncheckedTitle.classList.remove('contract-name-title')
                notificationUncheckedTitle.classList.add('contract-name-title-hidden')
                notificationCheckedTitle.classList.remove('contract-name-title-hidden')
                notificationCheckedTitle.classList.add('contract-name-title')
                readContract.classList.remove('document-img')
                readContract.classList.add('document-img-hidden')
                signedContract.classList.remove('document-img-hidden')
                signedContract.classList.add('document-img')
                isNotificationContractSigned = true
            } else {
                notificationSigningLine.classList.remove('signing-line-hidden')
                notificationSigningLine.classList.add('signing-line')
                notificationConfirmation.classList.remove('confirmed-display')
                notificationConfirmation.classList.add('confirmed')
                notificationCheckbox.classList.remove('checkbox-hidden')
                notificationContractInfo.classList.remove('contract-name-and-data-signed')
                notificationContractInfo.classList.add('contract-name-and-data')
                notificationUncheckedTitle.classList.remove('contract-name-title-hidden')
                notificationUncheckedTitle.classList.add('contract-name-title')
                notificationCheckedTitle.classList.remove('contract-name-title')
                notificationCheckedTitle.classList.add('contract-name-title-hidden')
                readContract.classList.remove('document-img-hidden')
                readContract.classList.add('document-img')
                signedContract.classList.remove('document-img-hidden')
                signedContract.classList.add('document-img')
                isNotificationContractSigned = false
            }
        })

        //кнопка в блоке судебных работ для эксперта
        // При появлении договора судебных работ, смена надписи "изучите договор" на "подписан в лк" при нажатии кнопки
        judicialSignButton.addEventListener("click", function () {
            if (!isJudicialContractSigned) {
                judicialSigningLine.classList.remove('signing-line')
                judicialSigningLine.classList.add('signing-line-hidden')
                judicialConfirmation.classList.remove('confirmed')
                judicialConfirmation.classList.add('confirmed-display')
                judicialCheckbox.classList.add('checkbox-hidden')
                judicialContractInfo.classList.remove('contract-name-and-data')
                judicialContractInfo.classList.add('contract-name-and-data-signed')
                judicialUncheckedTitle.classList.remove('contract-name-title')
                judicialUncheckedTitle.classList.add('contract-name-title-hidden')
                judicialCheckedTitle.classList.remove('contract-name-title-hidden')
                judicialCheckedTitle.classList.add('contract-name-title')
                readContract.classList.remove('document-img')
                readContract.classList.add('document-img-hidden')
                signedContract.classList.remove('document-img-hidden')
                signedContract.classList.add('document-img')
                isJudicialContractSigned = true
            } else {
                judicialSigningLine.classList.remove('signing-line-hidden')
                judicialSigningLine.classList.add('signing-line')
                judicialConfirmation.classList.remove('confirmed-display')
                judicialConfirmation.classList.add('confirmed')
                judicialCheckbox.classList.remove('checkbox-hidden')
                judicialContractInfo.classList.remove('contract-name-and-data-signed')
                judicialContractInfo.classList.add('contract-name-and-data')
                judicialUncheckedTitle.classList.remove('contract-name-title-hidden')
                judicialUncheckedTitle.classList.add('contract-name-title')
                judicialCheckedTitle.classList.remove('contract-name-title')
                judicialCheckedTitle.classList.add('contract-name-title-hidden')
                readContract.classList.remove('document-img-hidden')
                readContract.classList.add('document-img')
                signedContract.classList.remove('document-img-hidden')
                signedContract.classList.add('document-img')
                isJudicialContractSigned = false
            }
        })
    })

    //pdf файл подключается (договор)
    const urlCommon = 'contract/common-contract.pdf';
    const urlInformation = 'contract/information-contract.pdf';

    // путь к рабочему скрипту PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    function renderPage(page, container) {
        // Множитель масштабирования
        const scale = 1.5;
        const viewport = page.getViewport({ scale: scale });

        // Создаем элемент canvas
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        container.appendChild(canvas);

        //параметры рендеринга
        const renderContext = {
            canvasContext: context,
            viewport: viewport
        };

        // Рендер страницы
        page.render(renderContext).promise.then(() => {
        });
    }

    // Загружаем PDF документ
    // сначала общий, потом для судебной работы, потом для информирования
    pdfjsLib.getDocument(urlCommon).promise.then(pdfDoc => {
        console.log('PDF документ загружен');
        const container = document.getElementById('pdfViewer');
        for (let pageNum = 1; pageNum <= 7; pageNum++) {
            pdfDoc.getPage(pageNum).then(page => {
                renderPage(page, container);
            });
        }
    }).catch(err => {
        console.error('Ошибка загрузки PDF: ' + err);
    });


    pdfjsLib.getDocument(urlCommon).promise.then(pdfDoc => {
        console.log('PDF документ загружен');
        const container = document.getElementById('pdfViewerJudicial');
        for (let pageNum = 8; pageNum <= pdfDoc.numPages; pageNum++) {
            pdfDoc.getPage(pageNum).then(page => {
                renderPage(page, container);
            });
        }
    }).catch(err => {
        console.error('Ошибка загрузки PDF: ' + err);
    });

    pdfjsLib.getDocument(urlInformation).promise.then(pdfDoc => {
        console.log('PDF документ загружен');
        const container = document.getElementById('pdfViewerInformation');
        for (let pageNum = 8; pageNum <= pdfDoc.numPages; pageNum++) {
            pdfDoc.getPage(pageNum).then(page => {
                renderPage(page, container);
            });
        }
    }).catch(err => {
        console.error('Ошибка загрузки PDF: ' + err);
    });

</script>

</body>
</html>
