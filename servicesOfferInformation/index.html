<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Заказ услуги (Информирование)</title>
    <link rel="stylesheet" href="style.css">
    <link
            href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap"
            rel="stylesheet"
    />
    <link
            href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
    <link rel="stylesheet" href="custom-flatpickr.css">
</head>
<body>
<div class="main-container">
    <div class="title-position">
        <h2 class="services-title">Заказ услуги</h2>
    </div>
    <div class="services-container">
        <!-- Окно выбора услуг -->
        <div class="services-left">

            <div class="recent-services">
                <div class="recent-services-header">
                    <h3 class="recent-services-title">Выберите вид желаемой услуги</h3>
                    <p>
                        Вам необходимо принять
                        <a href="#">условия договора</a>
                        на предоставления услуги
                    </p>
                </div>

                <div class="selectors">
                    <div class="services-list">
                        <div class="services-list-item">
                            <div class="dropdown-container">
                                <label for="customDropdown" class="dropdown-label"> <span class="asterisk">*</span>
                                    Услуга</label>
                                <details id="customDropdown" class="custom-dropdown">
                                    <summary class="dropdown-toggle">Не выбрано
                                        <span class="dropdown-arrow">
      <img src="img/dropdown-arrow.svg" alt="v"/>
    </span>
                                    </summary>
                                    <ul class="dropdown-list">
                                        <!-- Невыбираемая строка (типа "хедер" для опций) -->
                                        <li class="dropdown-header-row">
                                            <span class="header-left">Наименование услуги</span>
                                            <span class="header-right">Статус договора</span>
                                        </li>
                                        <!-- Опция 1 (выбранная) -->
                                        <li class="dropdown-item selected">
                                            <div class="item-name-approved">Информирование</div>
                                            <span class="item-status-approved">
          <img src="img/item-status-approved.svg" alt="V">
          Подписан
        </span>
                                        </li>
                                        <!-- Опция 2 (невыбранная) -->
                                        <li class="dropdown-item">
                                            <div class="item-name">Судебная работа</div>
                                            <span class="item-status">
          <img src="img/item-status.svg" alt="status">
          Подписать
        </span>
                                        </li>
                                    </ul>
                                </details>
                            </div>


                        </div>
                    </div>

                    <!-- Окно выбора типа услуг -->
                    <div class="services-types">
                        <div class="services-list-item">
                            <div class="dropdown-container">
                                <label for="secondDropdown" class="dropdown-label"> <span class="asterisk">*</span> Тип
                                    услуги</label>
                                <details id="secondDropdown" class="custom-dropdown">
                                    <summary class="dropdown-toggle-type">Не выбрано
                                        <span class="dropdown-arrow">
      <img src="img/dropdown-arrow.svg" alt="v">
    </span>
                                    </summary>
                                    <ul class="dropdown-list">
                                        <!-- Опция 1 (выбранная) -->
                                        <li class="dropdown-item">
                                            <div class="type-item-name">Роботизированный звонок</div>

                                        </li>
                                        <!-- Опция 2 (невыбранная) -->
                                        <li class="dropdown-item">
                                            <div class="type-item-name">СМС</div>
                                        </li>
                                    </ul>
                                </details>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- кнопка добавления реестра-->
                <div class="add-file-line">
                    <button class="button-add-file" id="fileToggleBtn">
                        Добавить реестр
                    </button>
                    <span class="status-add-file" id="fileStatus">Реестр не выбран</span>
                </div>

                <!-- Ссылки на скачивание шаблонов-->
                <div class="download-links-container">
                    <div class="download-links">
                        <div class="one-link">
                            <img src="img/file-checked.svg" alt="file">
                            <a href="#">Скачать шаблон для заполнения реестра информирования</a>
                        </div>
                    </div>
                    <div class="download-links">
                        <div class="one-link">
                            <img src="img/file-checked.svg" alt="file">
                            <a href="#">Скачать инструкцию для заполнения реестра информирования</a>
                        </div>
                    </div>
                </div>

                <!-- выбор даты и ввод почты -->

                <div class="date-email-container">

                    <!-- дата-->
                    <div class="dropdown-container-date">
                        <label for="myDatepicker" class="dropdown-label">
                            <span class="asterisk">*</span>
                            Выберите дату начала периода
                            <!-- Обёртка для иконки + подсказка -->
                            <div class="tooltip-container">
                                <img src="img/help.svg" alt="?" class="help-icon" />
                                <div class="tooltip-text">
                                    <ul>Вне зависимости от выбранной даты, период предоставления услуги составит:
                                        <li class="description-line">3 дня <span class="description-muted">текст уведомления уже проходил проверку</span>
                                        </li>
                                        <li class="description-line">7 дней <span class="description-muted">текст будет проверен специалистом</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </label>
                        <div class="date-wrapper">
                            <input type="text" id="myDatepicker" class="date-input" placeholder="дд/мм/гггг">
                            <span class="date-arrow" id="myDateArrow">
        <img src="img/dropdown-arrow.svg" alt="v">
      </span>
                        </div>
                    </div>

                    <!-- Блок для почты -->
                    <div class="dropdown-container-email">
                        <label for="emailInput" class="dropdown-label">
                            <span class="asterisk">*</span>
                            Ваша почта, на которую мы ответим
                            <div class="tooltip-container">
                                <img src="img/help.svg" alt="?"/>
                                <div class="tooltip-text">
                                    Вы можете изменить адрес электронной почты
                                </div>
                            </div>
                        </label>
                        <input type="email" id="emailInput" class="email-input" placeholder="example@ya.ru">
                    </div>

                </div>

                <div class="button-line">
                    <ul class="description">Вне зависимости от выбранной даты, период предоставления услуги составит:
                        <li class="description-line">3 дня <span class="description-muted">текст уведомления уже проходил проверку</span>
                        </li>
                        <li class="description-line">7 дней <span class="description-muted">текст будет проверен специалистом</span>
                        </li>
                    </ul>
                    <button class="send-button" id="openModalBtn">Отправить</button>

                    <!-- модалка + затемнение фона (оверлей) -->
                    <div class="modal-overlay" id="modalOverlay">
                        <div class="modal-window">
                            <h2>Заявка была отправлена!</h2>
                            <p>Номер обращения: <span class="request">NES___</span></p>
                            <p>Отслеживайте статус заявки в <a href="#">истории заказов</a></p>
                            <div class="modal-buttons">
                                <button class="close-button" id="closeModalBtn">Закрыть</button>
                                <button class="order-list-button" id="ordersListBtn">История заказов</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Правая колонка (картинка + текст) -->
        <div class="services-right">
            <img
                    src="img/Information.png"
                    alt="Информирование"
                    class="services-reminder-image"
            />
            <p class="info-note">
                Вы можете воспользоваться нашей накопленной базой контактов или использовать свою
            </p>
        </div>
    </div>
</div>

<script>
    // кастомный календарь

    //сравнение дат
    function isSameDay(d1, d2) {
        return d1.getFullYear() === d2.getFullYear() &&
            d1.getMonth() === d2.getMonth() &&
            d1.getDate() === d2.getDate();
    }

    function getNextWorkingDays(startDate, count) {
        let result = [];
        let current = new Date(startDate);
        while (result.length < count) {
            if (current.getDay() !== 0 && current.getDay() !== 6) {
                result.push(new Date(current));
            }
            current.setDate(current.getDate() + 1);
        }
        return result;
    }


    const dateInput = document.getElementById('myDatepicker');
    dateInput.addEventListener('input', () =>{
        if (!dateInput.value.trim()) {
            fp.clear();
        }
    })
    const dateArrow = document.getElementById('myDateArrow');

    const fp = flatpickr('#myDatepicker', {
        dateFormat: 'd.m.Y',
        locale: 'ru',
        position: 'above',
        minDate: (function () {
            let d = new Date();
            d.setDate(d.getDate() + 1);
            return d;
        })(),
        disable: [
            function (date) {
                return (date.getDay() === 0 || date.getDay() === 6);
            }
        ],
        onChange: function (selectedDates, dateStr, instance) {
            if (selectedDates.length > 0) {
                const start = selectedDates[0];
                const blueRange = getNextWorkingDays(start, 3);

                const nextDay = new Date(blueRange[blueRange.length - 1]);
                nextDay.setDate(nextDay.getDate() + 1);
                const blueBorderRange = getNextWorkingDays(nextDay, 4);

                instance.blueRange = blueRange;
                instance.blueBorderRange = blueBorderRange;

                instance.redraw();
            }
        },
        onOpen: function (selectedDates, dateStr, instance) {
            dateArrow.classList.add('open');
        },
        onClose: function () {
            dateArrow.classList.remove('open')
        },
        onDayCreate: function (_, __, fp, dayElem) {

            const dateObj = dayElem.dateObj;
            if (!dateObj) return;

            if (fp.blueRange && fp.blueRange.some(d => isSameDay(d, dateObj))) {
                dayElem.classList.add('blue-bg');
            } else if (fp.blueBorderRange && fp.blueBorderRange.some(d => isSameDay(d, dateObj))) {
                dayElem.classList.add('blue-border');
            }
        }
    });

    document.querySelectorAll('.custom-dropdown').forEach((dropdown) => {
        const summary = dropdown.querySelector('summary');
        const arrow = summary.querySelector('.dropdown-arrow');
        const arrowHTML = arrow ? arrow.outerHTML : '';
        const items = dropdown.querySelectorAll('.dropdown-item');
        items.forEach((item) => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                let selectedText = '';
                const approvedName = item.querySelector('.item-name-approved');
                const normalName = item.querySelector('.item-name');
                const typeName = item.querySelector('.type-item-name');
                if (approvedName) {
                    selectedText = approvedName.textContent.trim();
                } else if (normalName) {
                    selectedText = normalName.textContent.trim();
                } else if (typeName) {
                    selectedText = typeName.textContent.trim();
                } else {
                    selectedText = item.textContent.trim();
                }
                summary.innerHTML = selectedText + arrowHTML;
                dropdown.removeAttribute('open');
                //проверяем заполнены ли все поля
                checkAllForms();
            });
        });
    });
    document.addEventListener('click', (e) => {
        document.querySelectorAll('.custom-dropdown').forEach((dropdown) => {
            if (!dropdown.contains(e.target)) {
                dropdown.removeAttribute('open');
            }
        });
    });

    //открытие модалки

    const openModalBtn = document.getElementById('openModalBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const modalOverlay = document.getElementById('modalOverlay');

    openModalBtn.addEventListener('click', () => {
        modalOverlay.classList.add('show');
    });

    closeModalBtn.addEventListener('click', () => {
        modalOverlay.classList.remove('show');
    });

    // закрытие при клике мимо модалки
    modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) {
            modalOverlay.classList.remove('show');
        }
    });

    //кнопка загрузки и удаления реестров
    const fileToggleBtn = document.getElementById('fileToggleBtn');
    const fileStatusSpan = document.getElementById('fileStatus');

    //флаг выбран ли реестр
    let fileSelected = false;

    fileToggleBtn.addEventListener('click', () => {
        if (!fileSelected) {
            fileToggleBtn.textContent = 'Удалить реестр';
            fileToggleBtn.classList.remove('button-add-file');
            fileToggleBtn.classList.add('button-delete-file');
            fileStatusSpan.textContent = 'Реестр_контактов_ЖКХ_Ромашка.xls';
            fileSelected = true;
        } else {
            fileToggleBtn.textContent = 'Добавить реестр';
            fileToggleBtn.classList.remove('button-delete-file');
            fileToggleBtn.classList.add('button-add-file');
            fileStatusSpan.textContent = 'Реестр не выбран';
            fileSelected = false;
        }
        checkAllForms();
    });

    //изменение цвета кнопки "отправить" в зависимости от выбранных полей

    const emailInput = document.getElementById('emailInput')
    emailInput.addEventListener('input', checkAllForms);
    emailInput.addEventListener('blur', checkAllForms);

    //dateInput инициализирована выше
    dateInput.addEventListener('input', checkAllForms)
    dateInput.addEventListener('blur', checkAllForms)

    function checkAllForms() {

        const serviceSummary = document
            .getElementById('customDropdown')
            .querySelector('summary')
        const serviceText = serviceSummary.textContent.trim()

        const typeSummary = document
            .getElementById('secondDropdown')
            .querySelector('summary')
        const typeText = typeSummary.textContent.trim()

        const fileStatus = document.getElementById('fileStatus').textContent.trim()

        const emailValue = emailInput.value.trim()
        const dateValue =dateInput.value.trim()

        const isServiceChosen = (serviceText !== 'Не выбрано');
        const isTypeChosen = (typeText !== 'Не выбрано');
        const isFileChosen = (fileStatus !== 'Реестр не выбран');
        const isEmailFilled = (emailValue !== '');
        const isDateFilled = (dateValue !== '')

        const sendButton = document.getElementById('openModalBtn');

        if (isEmailFilled && isFileChosen && isServiceChosen && isTypeChosen && isDateFilled) {
            sendButton.classList.add('send-button-active')
            sendButton.classList.remove('send-button')
        } else {
            sendButton.classList.add('send-button')
            sendButton.classList.remove('send-button-active')
        }
    }
    window.addEventListener('load', checkAllForms);

</script>

</body>
</html>
